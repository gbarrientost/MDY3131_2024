--CASO1
SET SERVEROUTPUT ON;
VAR B_ANNIO NUMBER
EXEC :B_ANNIO:=TO_CHAR(SYSDATE,'YYYY')

VAR B_COM1 VARCHAR2
EXEC :B_COM1:='María Pinto'
VAR B_VAL_COM1 NUMBER
EXEC :B_VAL_COM1:=20000

VAR B_COM2 VARCHAR2
EXEC :B_COM2:='Curacaví'
VAR B_VAL_COM2 NUMBER
EXEC :B_VAL_COM2:=25000
VAR B_COM3 VARCHAR2
EXEC :B_COM3:='Talagante'
VAR B_VAL_COM3 NUMBER
EXEC :B_VAL_COM3:=30000
VAR B_COM4 VARCHAR2
EXEC :B_COM4:='El Monte'
VAR B_VAL_COM4 NUMBER
EXEC :B_VAL_COM4:=35000


VAR B_COM5 VARCHAR2
EXEC :B_COM5:='Buin'
VAR B_VAL_COM5 NUMBER
EXEC :B_VAL_COM5:=40000

VAR B_RUT NUMBER
EXEC :B_RUT:=12272880



DECLARE

V_NUMRUN_EMP PROY_MOVILIZACION.NUMRUN_EMP%TYPE;
V_DVRUN_EMP PROY_MOVILIZACION.DVRUN_EMP%TYPE;
V_NOMBRE_EMPLEADO PROY_MOVILIZACION.NOMBRE_EMPLEADO%TYPE;
V_SUELDO_BASE PROY_MOVILIZACION.SUELDO_BASE%TYPE;
V_PORC_MOVIL_NORMAL PROY_MOVILIZACION.PORC_MOVIL_NORMAL%TYPE;
V_VALOR_MOVIL_NORMAL PROY_MOVILIZACION.VALOR_MOVIL_NORMAL%TYPE;
V_VALOR_MOVIL_EXTRA PROY_MOVILIZACION.VALOR_MOVIL_EXTRA%TYPE;
V_VALOR_TOTAL_MOVIL PROY_MOVILIZACION.VALOR_TOTAL_MOVIL%TYPE;
V_COMUNA COMUNA.NOMBRE_COMUNA%TYPE;
BEGIN



SELECT NUMRUN_EMP,DVRUN_EMP,PNOMBRE_EMP||' '||SNOMBRE_EMP||' '||
APPATERNO_EMP||' '||APMATERNO_EMP,SUELDO_BASE,C.NOMBRE_COMUNA
INTO V_NUMRUN_EMP,V_DVRUN_EMP,V_NOMBRE_EMPLEADO,V_SUELDO_BASE,V_COMUNA
FROM EMPLEADO E
INNER JOIN COMUNA C ON E.ID_COMUNA=C.ID_COMUNA
WHERE NUMRUN_EMP=:B_RUT;

V_PORC_MOVIL_NORMAL:=TRUNC(V_SUELDO_BASE/100000);
V_VALOR_MOVIL_NORMAL:=ROUND(V_SUELDO_BASE*(V_PORC_MOVIL_NORMAL/100));

IF (V_COMUNA=:B_COM1) THEN
    V_VALOR_MOVIL_EXTRA:= :B_VAL_COM1;
    DBMS_OUTPUT.PUT_LINE(V_VALOR_MOVIL_EXTRA);

   
  ELSIF (V_COMUNA=:B_COM2) THEN
    V_VALOR_MOVIL_EXTRA:= :B_VAL_COM2;
    DBMS_OUTPUT.PUT_LINE(V_VALOR_MOVIL_EXTRA);

   
  ELSIF (V_COMUNA=:B_COM3) THEN
    V_VALOR_MOVIL_EXTRA:= :B_VAL_COM3;
    DBMS_OUTPUT.PUT_LINE(V_VALOR_MOVIL_EXTRA);

   
  ELSIF (V_COMUNA=:B_COM4) THEN
    V_VALOR_MOVIL_EXTRA:= :B_VAL_COM4;
    DBMS_OUTPUT.PUT_LINE(V_VALOR_MOVIL_EXTRA);

  ELSIF (V_COMUNA=:B_COM5) THEN
    V_VALOR_MOVIL_EXTRA:= :B_VAL_COM5;
    DBMS_OUTPUT.PUT_LINE(V_VALOR_MOVIL_EXTRA);

     
  ELSE
  V_VALOR_MOVIL_EXTRA := 0;

   

  END IF;

   

  V_VALOR_TOTAL_MOVIL := (V_VALOR_MOVIL_NORMAL)+(V_VALOR_MOVIL_EXTRA);

   

  DBMS_OUTPUT.PUT_LINE('AÑO PROCESO: '||:B_ANNIO);
  DBMS_OUTPUT.PUT_LINE('RUT EMPLEADO: '|| V_NUMRUN_EMP||'-'||V_DVRUN_EMP);
  DBMS_OUTPUT.PUT_LINE('NOMBRE EMPLEADO: '||V_NOMBRE_EMPLEADO);
  DBMS_OUTPUT.PUT_LINE('SUELDO BASE: '||V_SUELDO_BASE);  
  DBMS_OUTPUT.PUT_LINE('PORCENTAJE MOVILIZACIÓN NORMAL: '||V_PORC_MOVIL_NORMAL);
  DBMS_OUTPUT.PUT_LINE('VALOR MOVILIZACIÓN NORMAL: '||V_VALOR_MOVIL_NORMAL);
  DBMS_OUTPUT.PUT_LINE('VALOR MOVILIZACIÓN ADICIONAL: '||V_VALOR_MOVIL_EXTRA);
  DBMS_OUTPUT.PUT_LINE('VALOR TOTAL MOVILIZACIÓN: '||V_VALOR_TOTAL_MOVIL);


  INSERT INTO PROY_MOVILIZACION(ANNO_PROCESO, NUMRUN_EMP, DVRUN_EMP, NOMBRE_EMPLEADO, SUELDO_BASE, PORC_MOVIL_NORMAL, VALOR_MOVIL_NORMAL, VALOR_MOVIL_EXTRA, VALOR_TOTAL_MOVIL) 
  VALUES (:B_ANNIO, V_NUMRUN_EMP, V_DVRUN_EMP, V_NOMBRE_EMPLEADO, V_SUELDO_BASE, V_PORC_MOVIL_NORMAL, V_VALOR_MOVIL_NORMAL, V_VALOR_MOVIL_EXTRA, V_VALOR_TOTAL_MOVIL);
  COMMIT;

END;
